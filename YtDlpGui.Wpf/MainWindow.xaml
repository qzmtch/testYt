<Window x:Class="YtDlpGui.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="yt-dlp GUI" Width="980" Height="720" WindowStartupLocation="CenterScreen"
        Background="{StaticResource Brush.Bg}">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <Grid Margin="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="8"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Заголовок -->
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="yt-dlp GUI" FontWeight="SemiBold" FontSize="18"/>
                <TextBlock Text=" · NET Framework 4.7.2" Margin="8,0,0,0" Foreground="{StaticResource Brush.Muted}"/>
            </StackPanel>

            <!-- Основная карточка -->
            <Border Grid.Row="2" Style="{StaticResource Card}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="3*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Левая панель -->
                    <StackPanel Margin="0,0,12,0">
                        <TextBlock Text="Ссылка на видео" Margin="0,0,0,6" Foreground="{StaticResource Brush.Muted}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="UrlText" Grid.Column="0" MinHeight="32" Margin="0,0,6,0"/>
                            <Button x:Name="FetchBtn" Grid.Column="1" Content="Получить" Click="FetchBtn_Click" MinWidth="100"/>
                        </Grid>

                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <TextBlock Text="yt-dlp:" Foreground="{StaticResource Brush.Muted}" VerticalAlignment="Center"/>
                            <TextBox x:Name="YtDlpPathText" Width="260" Margin="6,0,0,0" ToolTip="Путь к yt-dlp.exe (если не в PATH)"/>
                            <Button Content="Обзор" Click="BrowseYtDlp_Click"/>
                        </StackPanel>

                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="{Binding Title}" FontSize="16" FontWeight="SemiBold" TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding WebpageUrl}" Foreground="{StaticResource Brush.Muted}" TextWrapping="Wrap"/>
                                <Image x:Name="ThumbImage" Height="160" Stretch="UniformToFill" Margin="0,10,0,0"/>
                                <TextBlock Text="{Binding Description}" Foreground="{StaticResource Brush.Muted}" TextWrapping="Wrap" Margin="0,10,0,0" MaxHeight="80"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Правая панель -->
                    <StackPanel Grid.Column="1">

                        <!-- Простой режим -->
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Простой режим" Foreground="{StaticResource Brush.Muted}"/>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,6">
                                    <RadioButton x:Name="TypeVideo" Content="Видео" IsChecked="True" Checked="DownloadTypeChanged"/>
                                    <RadioButton x:Name="TypeAudio" Content="Аудио" Margin="12,0,0,0" Checked="DownloadTypeChanged"/>
                                    <RadioButton x:Name="TypeCustom" Content="Кастом" Margin="12,0,0,0" Checked="DownloadTypeChanged"/>
                                </StackPanel>

                                <!-- Видео-опции -->
                                <StackPanel x:Name="VideoOptionsPanel">
                                    <Grid Margin="0,0,0,6">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Качество:" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                        <ComboBox x:Name="QualityCombo" Grid.Column="1" Margin="6,0,12,0" MinWidth="120">
                                            <ComboBoxItem Content="best" IsSelected="True"/>
                                        </ComboBox>

                                        <TextBlock Grid.Column="2" Text="Формат:" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                        <ComboBox x:Name="VideoFormatCombo" Grid.Column="3" Margin="6,0,0,0" MinWidth="120">
                                            <ComboBoxItem Content="Авто" IsSelected="True"/>
                                            <ComboBoxItem Content="mp4"/>
                                            <ComboBoxItem Content="webm"/>
                                        </ComboBox>
                                    </Grid>

                                    <StackPanel Orientation="Horizontal">
                                        <CheckBox x:Name="VideoAddAudioCheck" Content="Добавить звук" IsChecked="True"/>
                                        <TextBlock Text="Аудио формат:" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}" Margin="12,0,0,0"/>
                                        <ComboBox x:Name="VideoAudioFormatCombo" MinWidth="110" Margin="6,0,0,0">
                                            <ComboBoxItem Content="Авто" IsSelected="True"/>
                                            <ComboBoxItem Content="m4a"/>
                                            <ComboBoxItem Content="opus"/>
                                        </ComboBox>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Аудио-опции -->
                                <StackPanel x:Name="AudioOptionsPanel" Visibility="Collapsed">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Формат аудио:" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                        <ComboBox x:Name="AudioFormatCombo" MinWidth="140" Margin="6,0,0,0">
                                            <ComboBoxItem Content="Авто" IsSelected="True"/>
                                            <ComboBoxItem Content="m4a"/>
                                            <ComboBoxItem Content="opus"/>
                                            <ComboBoxItem Content="mp3"/>
                                        </ComboBox>
                                    </StackPanel>
                                </StackPanel>

                                <CheckBox x:Name="IgnoreConfigCheck" Content="Игнорировать конфиг (--ignore-config)" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Пресеты (аккордеон) -->
                        <Expander Header="Пресеты" IsExpanded="False">
                            <StackPanel>
                                <ComboBox x:Name="PresetsCombo" DisplayMemberPath="Name" SelectionChanged="PresetsCombo_SelectionChanged" Margin="0,6,0,6"/>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="140"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Имя:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                    <TextBox x:Name="PresetNameText" Grid.Row="0" Grid.Column="1" Margin="6,0,0,0"/>
                                    <TextBlock Text="Аргументы (без URL и -o):" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}" />
                                    <TextBox x:Name="PresetArgsText" Grid.Row="1" Grid.Column="1" Margin="6,6,0,0"/>
                                </Grid>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <Button Content="Сохранить пресет" Click="SavePreset_Click"/>
                                    <Button Content="Скачать пресетом" Margin="6,0,0,0" Click="DownloadPreset_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Expander>

                        <!-- Расширенные (кастом) -->
                        <Expander Header="Расширенные (форматы/мультистрим/-S)" IsExpanded="False">
                            <StackPanel>
                                <TextBlock Text="Типы для списка" Foreground="{StaticResource Brush.Muted}" Margin="0,0,0,4"/>
                                <StackPanel Orientation="Horizontal">
                                    <RadioButton x:Name="FilterAll" Content="Все" IsChecked="True" Checked="FilterChanged"/>
                                    <RadioButton x:Name="FilterVideo" Content="Видео" Margin="12,0,0,0" Checked="FilterChanged"/>
                                    <RadioButton x:Name="FilterAudio" Content="Аудио" Margin="12,0,0,0" Checked="FilterChanged"/>
                                </StackPanel>
                                <Grid Margin="0,6,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="ExtCombo" Grid.Column="0" MinWidth="140" SelectionChanged="FilterChanged">
                                        <ComboBoxItem Content="Все" IsSelected="True"/>
                                    </ComboBox>
                                    <ComboBox x:Name="ProtoCombo" Grid.Column="1" MinWidth="140" SelectionChanged="FilterChanged">
                                        <ComboBoxItem Content="Любой протокол" IsSelected="True"/>
                                        <ComboBoxItem Content="https"/>
                                        <ComboBoxItem Content="m3u8_native"/>
                                        <ComboBoxItem Content="http"/>
                                        <ComboBoxItem Content="dash"/>
                                    </ComboBox>
                                    <ComboBox x:Name="ResCombo" Grid.Column="2" MinWidth="140" SelectionChanged="FilterChanged">
                                        <ComboBoxItem Content="Любое разрешение" IsSelected="True"/>
                                    </ComboBox>
                                </Grid>

                                <TextBlock Text="Форматы (множественный выбор)" Foreground="{StaticResource Brush.Muted}"/>
                                <ListBox x:Name="FormatsList" SelectionMode="Extended" DisplayMemberPath="Display" Height="220" Margin="0,6,0,6"/>

                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Режим: " VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                    <RadioButton x:Name="MergePlusRadio" Content="Объединить (+)" IsChecked="True" Margin="6,0,0,0"/>
                                    <RadioButton x:Name="SeparateCommaRadio" Content="Отдельно (,)" Margin="12,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <CheckBox x:Name="VideoMultistreamsCheck" Content="--video-multistreams"/>
                                    <CheckBox x:Name="AudioMultistreamsCheck" Content="--audio-multistreams" Margin="12,0,0,0"/>
                                </StackPanel>

                                <TextBlock Text="Сортировка (-S)" Foreground="{StaticResource Brush.Muted}" Margin="0,8,0,2"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="230"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="SortPresetCombo" Grid.Column="0" SelectionChanged="SortPresetCombo_SelectionChanged">
                                        <ComboBoxItem Content="(нет)"/>
                                        <ComboBoxItem Content="ext"/>
                                        <ComboBoxItem Content="+size,+br,+res,+fps"/>
                                        <ComboBoxItem Content="height:720"/>
                                        <ComboBoxItem Content="proto"/>
                                        <ComboBoxItem Content="codec:h264"/>
                                        <ComboBoxItem Content="+res:480"/>
                                    </ComboBox>
                                    <TextBox x:Name="SortText" Grid.Column="1" Margin="6,0,0,0" ToolTip="Строка для -S (--format-sort)"/>
                                </Grid>

                                <Border Style="{StaticResource Card}">
                                    <StackPanel>
                                        <TextBlock Text="Субтитры" Foreground="{StaticResource Brush.Muted}"/>
                                        <ItemsControl x:Name="SubsItems">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <CheckBox Content="{Binding}" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Expander>

                        <!-- Выходная папка + кнопки -->
                        <TextBlock Text="Папка сохранения" Foreground="{StaticResource Brush.Muted}" Margin="0,10,0,6"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="OutputFolderText" MinHeight="32" Grid.Column="0" Margin="0,0,6,0"/>
                            <Button Content="Обзор" Grid.Column="1" Click="BrowseOutput_Click"/>
                        </Grid>

                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                            <Button x:Name="DownloadBtn" Content="Скачать" Click="DownloadBtn_Click"/>
                            <Button x:Name="CancelBtn" Content="Отмена" Click="CancelBtn_Click" IsEnabled="False"/>
                            <Button Content="Открыть папку" Click="OpenFolder_Click"/>
                            <Button Content="Скопировать команду" Click="CopyCmd_Click"/>
                        </StackPanel>

                        <ProgressBar x:Name="ProgressBar" Margin="0,10,0,0" Minimum="0" Maximum="100" Height="8"/>
                        <TextBlock x:Name="ProgressText" Foreground="{StaticResource Brush.Muted}" Margin="0,4,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Статус -->
            <TextBlock Grid.Row="4" x:Name="StatusText" Foreground="{StaticResource Brush.Muted}" Text="Готово" />
        </Grid>
    </ScrollViewer>
</Window>

<Window x:Class="YtDlpGui.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="yt-dlp GUI" Width="980" Height="720" WindowStartupLocation="CenterScreen"
        Background="{StaticResource Brush.Bg}">
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="4"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Заголовок (убран визуально) -->
        <StackPanel Orientation="Horizontal" Visibility="Collapsed">
            <TextBlock Text="yt-dlp GUI" FontWeight="SemiBold" FontSize="18"/>
            <TextBlock Text=" · NET Framework 4.7.2" Margin="8,0,0,0" Foreground="{StaticResource Brush.Muted}"/>
        </StackPanel>

        <!-- Прокручиваемый контент -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <Border Style="{StaticResource Card}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="3*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Левая панель -->
                    <StackPanel Margin="0,0,8,0">

                        <!-- Ввод ссылки -->
                        <TextBlock Text="Ссылка на видео" Margin="0,0,0,4" Foreground="{StaticResource Brush.Muted}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="UrlText" Grid.Column="0" MinHeight="28" Margin="0,0,6,0"/>
                            <Button x:Name="FetchBtn" Grid.Column="1" Content="Получить" Click="FetchBtn_Click" MinWidth="90"/>
                        </Grid>

                        <!-- Карточка превью -->
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="{Binding Title}" FontSize="15" FontWeight="SemiBold" TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding WebpageUrl}" Foreground="{StaticResource Brush.Muted}" TextWrapping="Wrap"/>
                                <Image x:Name="ThumbImage" Height="160" Stretch="UniformToFill" Margin="0,8,0,0"/>
                                <TextBlock Text="{Binding Description}" Foreground="{StaticResource Brush.Muted}" TextWrapping="Wrap" Margin="0,8,0,0" MaxHeight="80"/>
                            </StackPanel>
                        </Border>

                        <!-- Действия: пути, кнопки, прогресс -->
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Сохранение и инструменты" Foreground="{StaticResource Brush.Muted}"/>

                                <!-- Папка сохранения -->
                                <TextBlock Text="Папка сохранения" Foreground="{StaticResource Brush.Muted}" Margin="0,6,0,4"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="OutputFolderText" MinHeight="28" Grid.Column="0" Margin="0,0,6,0"/>
                                    <Button Content="Обзор" Grid.Column="1" Click="BrowseOutput_Click" MinWidth="70"/>
                                </Grid>

                                <!-- yt-dlp -->
                                <TextBlock Text="yt-dlp" Foreground="{StaticResource Brush.Muted}" Margin="0,8,0,4"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBox x:Name="YtDlpPathText" MinHeight="28" Grid.Column="0" Margin="0,0,6,0"
                                             ToolTip="Путь к yt-dlp.exe (если не в PATH)"/>
                                    <Button Content="Обзор" Grid.Column="1" Click="BrowseYtDlp_Click" MinWidth="70"/>
                                </Grid>

                                <!-- Кнопки -->
                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <Button x:Name="DownloadBtn" Content="Скачать" Click="DownloadBtn_Click" MinWidth="92"/>
                                    <Button x:Name="CancelBtn" Content="Отмена" Click="CancelBtn_Click" IsEnabled="False" MinWidth="92"/>
                                    <Button Content="Открыть папку" Click="OpenFolder_Click" MinWidth="110"/>
                                    <Button Content="Скопировать команду" Click="CopyCmd_Click" MinWidth="150"/>
                                </StackPanel>

                                <!-- Прогресс -->
                                <ProgressBar x:Name="ProgressBar" Margin="0,8,0,0" Minimum="0" Maximum="100" Height="6"/>
                                <TextBlock x:Name="ProgressText" Foreground="{StaticResource Brush.Muted}" Margin="0,4,0,0"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>

                    <!-- Правая панель -->
                    <StackPanel Grid.Column="1" Margin="0,0,0,0">

                        <!-- Базовый режим -->
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Базовый режим" Foreground="{StaticResource Brush.Muted}" Margin="0,0,0,4"/>

                                <!-- Тип скачивания -->
                                <StackPanel Orientation="Horizontal">
                                    <RadioButton x:Name="VideoTypeRadio" Content="Видео" IsChecked="True" Checked="DownloadTypeChanged"/>
                                    <RadioButton x:Name="AudioTypeRadio" Content="Аудио" Margin="12,0,0,0" Checked="DownloadTypeChanged"/>
                                    <RadioButton x:Name="CustomTypeRadio" Content="Кастом" Margin="12,0,0,0" Checked="DownloadTypeChanged"/>
                                </StackPanel>

                                <!-- Качество + добавить аудио -->
                                <Grid Margin="6,6,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="230" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Orientation="Horizontal" Grid.Column="0">
                                        <TextBlock Text="Качество:" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                        <ComboBox x:Name="QualityCombo" Width="120" Margin="6,0,0,0">
                                            <ComboBoxItem Content="best" IsSelected="True"/>
                                            <ComboBoxItem Content="2160p"/>
                                            <ComboBoxItem Content="1440p"/>
                                            <ComboBoxItem Content="1080p"/>
                                            <ComboBoxItem Content="720p"/>
                                            <ComboBoxItem Content="480p"/>
                                            <ComboBoxItem Content="360p"/>
                                            <ComboBoxItem Content="240p"/>
                                            <ComboBoxItem Content="144p"/>
                                        </ComboBox>
                                    </StackPanel>
                                    <CheckBox x:Name="AddAudioCheck" Grid.Column="1" Content="Добавить аудио" IsChecked="True" HorizontalAlignment="Left"/>
                                </Grid>

                                <!-- Формат (видео/аудио) и кастом -->
                                <Grid Margin="6,6,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="230" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Формат (видео)" Foreground="{StaticResource Brush.Muted}"/>
                                        <ComboBox x:Name="VideoFormatCombo" MinWidth="160">
                                            <ComboBoxItem Content="best" IsSelected="True"/>
                                            <ComboBoxItem Content="mp4"/>
                                            <ComboBoxItem Content="webm"/>
                                            <ComboBoxItem Content="mkv"/>
                                            <ComboBoxItem Content="flv"/>
                                            <ComboBoxItem Content="avi"/>
                                            <ComboBoxItem Content="mov"/>
                                        </ComboBox>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Формат (аудио)" Foreground="{StaticResource Brush.Muted}"/>
                                        <ComboBox x:Name="AudioFormatCombo" MinWidth="160">
                                            <ComboBoxItem Content="best" IsSelected="True"/>
                                            <ComboBoxItem Content="m4a"/>
                                            <ComboBoxItem Content="mp3"/>
                                            <ComboBoxItem Content="opus"/>
                                            <ComboBoxItem Content="ogg"/>
                                            <ComboBoxItem Content="webm"/>
                                        </ComboBox>
                                    </StackPanel>
                                </Grid>

                                <StackPanel x:Name="CustomFormatPanel" Margin="0,6,0,0" Visibility="Collapsed">
                                    <TextBlock Text="Кастомный -f" Foreground="{StaticResource Brush.Muted}"/>
                                    <TextBox x:Name="CustomFormatText" />
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Пресеты -->
                        <Border Style="{StaticResource Card}">
                            <StackPanel>
                                <TextBlock Text="Пресеты" Foreground="{StaticResource Brush.Muted}"/>
                                <ComboBox x:Name="PresetsCombo" DisplayMemberPath="Name" SelectionChanged="PresetsCombo_SelectionChanged" Margin="0,6,0,6"/>
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Имя:" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                    <TextBox x:Name="PresetNameText" Grid.Row="0" Grid.Column="1" Margin="6,0,0,0"/>
                                    <TextBlock Text="Аргументы (yt-dlp, без URL и -o):" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}" />
                                    <TextBox x:Name="PresetArgsText" Grid.Row="1" Grid.Column="1" Margin="6,6,0,0"/>
                                </Grid>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <Button Content="Сохранить пресет" Click="SavePreset_Click" MinWidth="120"/>
                                    <Button Content="Скачать пресетом" Margin="6,0,0,0" Click="DownloadPreset_Click" MinWidth="130"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Расширенные форматы -->
                        <Expander Header="Расширенные форматы (из JSON), множественный выбор" IsExpanded="False" Margin="0,8,0,0">
                            <StackPanel>
                                <TextBlock Text="Фильтры" Foreground="{StaticResource Brush.Muted}" />
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,6">
                                    <RadioButton x:Name="FilterAll" Content="Все" IsChecked="True" Checked="FilterChanged"/>
                                    <RadioButton x:Name="FilterVideo" Content="Видео" Margin="12,0,0,0" Checked="FilterChanged"/>
                                    <RadioButton x:Name="FilterAudio" Content="Аудио" Margin="12,0,0,0" Checked="FilterChanged"/>
                                </StackPanel>

                                <Grid Margin="0,0,0,6">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="ExtCombo" Grid.Column="0" MinWidth="140" SelectionChanged="FilterChanged">
                                        <ComboBoxItem Content="Все" IsSelected="True"/>
                                    </ComboBox>
                                    <ComboBox x:Name="ProtoCombo" Grid.Column="1" MinWidth="140" SelectionChanged="FilterChanged">
                                        <ComboBoxItem Content="Любой протокол" IsSelected="True"/>
                                        <ComboBoxItem Content="https"/>
                                        <ComboBoxItem Content="m3u8_native"/>
                                        <ComboBoxItem Content="http"/>
                                        <ComboBoxItem Content="dash"/>
                                    </ComboBox>
                                    <ComboBox x:Name="ResCombo" Grid.Column="2" MinWidth="140" SelectionChanged="FilterChanged">
                                        <ComboBoxItem Content="Любое разрешение" IsSelected="True"/>
                                    </ComboBox>
                                </Grid>

                                <ListBox x:Name="FormatsList" SelectionMode="Extended" DisplayMemberPath="Display" Height="200"/>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <TextBlock Text="Режим:" VerticalAlignment="Center" Foreground="{StaticResource Brush.Muted}"/>
                                    <RadioButton x:Name="MergePlusRadio" Content="Объединить (+)" IsChecked="True" Margin="6,0,0,0"/>
                                    <RadioButton x:Name="SeparateCommaRadio" Content="Отдельно (,)" Margin="12,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </Expander>

                        <!-- Дополнительно -->
                        <Expander Header="Дополнительно" IsExpanded="False" Margin="0,8,0,0">
                            <StackPanel>
                                <CheckBox x:Name="IgnoreConfigCheck" Content="Игнорировать конфиг (--ignore-config)"/>
                                <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                    <CheckBox x:Name="VideoMultistreamsCheck" Content="--video-multistreams"/>
                                    <CheckBox x:Name="AudioMultistreamsCheck" Content="--audio-multistreams" Margin="12,0,0,0"/>
                                </StackPanel>
                                <TextBlock Text="Сортировка (-S)" Foreground="{StaticResource Brush.Muted}" Margin="0,6,0,0"/>
                                <Grid Margin="0,6,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="220"/>
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <ComboBox x:Name="SortPresetCombo" Grid.Column="0" SelectionChanged="SortPresetCombo_SelectionChanged">
                                        <ComboBoxItem Content="(нет)"/>
                                        <ComboBoxItem Content="ext"/>
                                        <ComboBoxItem Content="+size,+br,+res,+fps"/>
                                        <ComboBoxItem Content="height:720"/>
                                        <ComboBoxItem Content="proto"/>
                                        <ComboBoxItem Content="codec:h264"/>
                                        <ComboBoxItem Content="+res:480"/>
                                    </ComboBox>
                                    <TextBox x:Name="SortText" Grid.Column="1" Margin="6,0,0,0"
                                             ToolTip="Произвольная строка для -S (--format-sort)"/>
                                </Grid>
                            </StackPanel>
                        </Expander>

                        <!-- Субтитры -->
                        <Expander Header="Субтитры" IsExpanded="False" Margin="0,8,0,0">
                            <Border Style="{StaticResource Card}">
                                <ItemsControl x:Name="SubsItems">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <CheckBox Content="{Binding}" />
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>
                        </Expander>

                    </StackPanel>
                </Grid>
            </Border>
        </ScrollViewer>

        <!-- Статус -->
        <TextBlock Grid.Row="3" x:Name="StatusText" Foreground="{StaticResource Brush.Muted}" Text="Готово" />
    </Grid>
</Window>
